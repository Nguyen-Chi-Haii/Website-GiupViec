<div class="dashboard">
  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-800 m-0">Tổng Quan</h2>
      <p class="text-gray-500 text-sm mt-1">Thống kê hoạt động hệ thống</p>
    </div>
    <app-date-range-picker 
      [initialStartDate]="startDate()"
      [initialEndDate]="endDate()"
      (rangeChange)="onDateRangeChange($event)">
    </app-date-range-picker>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon blue">
          <span class="material-symbols-outlined">group</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Tổng người dùng</p>
        <h3 class="stat-value">{{ stats()?.totalUsers || 0 | number }}</h3>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon orange">
          <span class="material-symbols-outlined">badge</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Tổng nhân viên</p>
        <h3 class="stat-value">{{ stats()?.totalHelpers || 0 | number }}</h3>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon purple">
          <span class="material-symbols-outlined">person_check</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Tổng khách hàng</p>
        <h3 class="stat-value">{{ stats()?.totalCustomers || 0 | number }}</h3>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon indigo">
          <span class="material-symbols-outlined">receipt_long</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Tổng đơn đặt</p>
        <h3 class="stat-value">{{ stats()?.totalBookings || 0 | number }}</h3>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon primary">
          <span class="material-symbols-outlined">payments</span>
        </div>
      </div>
      <div class="stat-body">
        <p class="stat-label">Tổng doanh thu</p>
        <h3 class="stat-value">{{ stats()?.totalRevenue || 0 | number }}₫</h3>
      </div>
    </div>

    <div class="stat-card highlight">
      <div class="stat-header">
        <div class="stat-icon red">
          <span class="material-symbols-outlined">pending_actions</span>
        </div>
        <span class="stat-badge">Cần xử lý</span>
      </div>
      <div class="stat-body">
        <p class="stat-label">Đơn chờ xử lý</p>
        <h3 class="stat-value">{{ stats()?.pendingBookings || 0 }}</h3>
      </div>
    </div>
  </div>

  <!-- Revenue Chart -->
  <div class="section-card mb-6">
    <div class="section-header">
      <h3>Biểu đồ doanh thu</h3>
    </div>
    <div class="p-4">
      <app-revenue-chart 
        [startDate]="startDate()" 
        [endDate]="endDate()">
      </app-revenue-chart>
    </div>
  </div>

  <!-- Recent Orders Table -->
  <div class="section-card">
    <div class="section-header">
      <h3>Đơn hàng gần đây</h3>
      <a routerLink="/admin/bookings" class="view-all">Xem tất cả</a>
    </div>
    <div class="table-container">
      @if (isLoading()) {
        <div class="loading">Đang tải...</div>
      } @else {
        <table class="data-table">
          <thead>
            <tr>
              <th>Mã đơn</th>
              <th>Khách hàng</th>
              <th>Dịch vụ</th>
              <th>Trạng thái</th>
              <th>Ngày đặt</th>
              <th>Tổng tiền</th>
            </tr>
          </thead>
          <tbody>
            @for (booking of recentBookings(); track booking.id) {
              <tr>
                <td class="font-medium" data-label="Mã đơn">#{{ booking.id }}</td>
                <td data-label="Khách hàng">{{ booking.customerName }}</td>
                <td class="text-muted" data-label="Dịch vụ">{{ booking.serviceName }}</td>
                <td data-label="Trạng thái">
                  <span class="status-badge" [class]="getStatusClass(booking.status)">
                    {{ getStatusLabel(booking.status) }}
                  </span>
                </td>
                <td class="text-muted" data-label="Ngày đặt">{{ booking.createdAt | date:'dd/MM/yyyy' }}</td>
                <td class="font-medium" data-label="Tổng tiền">{{ booking.totalPrice | number }}₫</td>
              </tr>
            } @empty {
              <tr>
                <td colspan="6" class="empty-state">Chưa có đơn hàng nào</td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>
</div>
