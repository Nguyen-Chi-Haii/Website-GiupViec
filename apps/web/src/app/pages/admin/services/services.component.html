<div class="page">
  <div class="page-header">
    <h2>Quản Lý Dịch Vụ</h2>
    <button class="btn-primary" (click)="openCreateModal()">
      <span class="material-symbols-outlined">add</span>
      Thêm Dịch Vụ
    </button>
  </div>

  <div class="card">
    <div class="table-container">
      @if (isLoading()) {
        <div class="loading">Đang tải...</div>
      } @else {
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Tên dịch vụ</th>
              <th>Giá</th>
              <th>Trạng thái</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody>
            @for (service of services(); track service.id) {
              <tr>
                <td class="font-medium">#{{ service.id }}</td>
                <td>{{ service.name }}</td>
                <td class="font-medium">{{ service.price | number }}₫/giờ</td>
                <td>
                  <span class="status-badge" [class.active]="service.isActive" [class.inactive]="!service.isActive">
                    {{ service.isActive ? 'Hoạt động' : 'Tạm dừng' }}
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="icon-btn" title="Sửa" (click)="openEditModal(service)">
                      <span class="material-symbols-outlined">edit</span>
                    </button>
                    <button class="icon-btn" title="Đổi trạng thái" (click)="toggleStatus(service)">
                      <span class="material-symbols-outlined">
                        {{ service.isActive ? 'pause' : 'play_arrow' }}
                      </span>
                    </button>
                  </div>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="5" class="empty-state">Chưa có dịch vụ nào</td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>

  <!-- Create/Edit Modal -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ isEditing() ? 'Sửa Dịch Vụ' : 'Thêm Dịch Vụ Mới' }}</h3>
          <button class="close-btn" (click)="closeModal()">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Tên dịch vụ</label>
            <input 
              type="text" 
              [value]="formData.name()" 
              (input)="formData.name.set($any($event.target).value); markTouched('name')"
              (blur)="markTouched('name')"
              placeholder="VD: Dọn dẹp nhà cửa" 
              [class.error]="(touchedFields().has('name') || isSubmitted()) && errors()['name']" 
            />
            @if ((touchedFields().has('name') || isSubmitted()) && errors()['name']) {
              <span class="error-text">{{ errors()['name'] }}</span>
            }
          </div>
          <div class="form-group">
            <label>Giá (VNĐ/giờ)</label>
            <input 
              type="number" 
              [value]="formData.price()" 
              (input)="formData.price.set($any($event.target).value ? +$any($event.target).value : null); markTouched('price')"
              (blur)="markTouched('price')"
              placeholder="VD: 50000" 
              [class.error]="(touchedFields().has('price') || isSubmitted()) && errors()['price']" 
            />
            @if ((touchedFields().has('price') || isSubmitted()) && errors()['price']) {
              <span class="error-text">{{ errors()['price'] }}</span>
            }
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-outline" (click)="closeModal()">Hủy</button>
          <button class="btn-primary" (click)="saveService()">
            {{ isEditing() ? 'Cập nhật' : 'Tạo mới' }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
