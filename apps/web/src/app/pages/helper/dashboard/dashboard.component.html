<div class="page">
  <div class="page-header">
    <div class="header-main">
      <h1>Xin ch√†o, {{ userName() }}! üëã</h1>
      @if (profile()) {
        <span class="status-badge" [class]="profileStatusClass()">
          {{ profile()!.status === 'Active' ? 'ƒêang ho·∫°t ƒë·ªông' : 'T·∫°m d·ª´ng/Ch∆∞a k√≠ch ho·∫°t' }}
        </span>
      }
    </div>
    
    <div class="header-actions flex items-center justify-between mt-4">
      <p class="subtitle mb-0">Th·ªëng k√™ v√† t·ªïng quan c√¥ng vi·ªác</p>
      
      <div class="w-64">
        <app-date-range-picker
          [initialStartDate]="startDate()"
          [initialEndDate]="endDate()"
          (rangeChange)="handleDateChange($event)">
        </app-date-range-picker>
      </div>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon today">
        <span class="material-symbols-outlined">today</span>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats()?.totalUpcomingJobs || 0 }}</span>
        <span class="stat-label">Vi·ªác s·∫Øp t·ªõi</span>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon rating">
        <span class="material-symbols-outlined">star</span>
      </div>
      <div class="stat-info">
        <div class="rating-value">
          <span class="stat-value">{{ stats()?.averageRating | number:'1.1-1' }}</span>
          <span class="rating-count">({{ stats()?.ratingCount || 0 }} ƒë√°nh gi√°)</span>
        </div>
        <span class="stat-label">ƒêi·ªÉm ƒë√°nh gi√°</span>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon completed">
        <span class="material-symbols-outlined">task_alt</span>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats()?.totalCompletedJobs || 0 }}</span>
        <span class="stat-label">ƒê√£ ho√†n th√†nh</span>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon earnings">
        <span class="material-symbols-outlined">payments</span>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats()?.totalEarnings || 0 | number }}‚Ç´</span>
        <span class="stat-label">T·ªïng thu nh·∫≠p</span>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <!-- Main Column: Schedule and History -->
    <div class="main-column">
      <!-- Current & Upcoming Jobs -->
      <div class="section">
        <div class="section-header">
          <h2>C√¥ng vi·ªác c·∫ßn th·ª±c hi·ªán</h2>
          <a routerLink="/helper/schedule" class="link-btn">Xem t·∫•t c·∫£ l·ªãch</a>
        </div>
        
        @if (isLoading()) {
          <div class="loading">ƒêang t·∫£i...</div>
        } @else if (todaySchedule().length === 0) {
          <div class="empty-card">
            <div class="empty-icon">
              <span class="material-symbols-outlined">event_available</span>
            </div>
            <p>B·∫°n kh√¥ng c√≥ c√¥ng vi·ªác n√†o c·∫ßn x·ª≠ l√Ω hi·ªán t·∫°i.</p>
            <button routerLink="/helper/schedule" class="btn-outline">Xem l·ªãch c·ªßa t√¥i</button>
          </div>
        } @else {
          <div class="schedule-list">
            @for (job of todaySchedule(); track job.id) {
              <div class="job-card">
                <div class="job-time">
                  <span class="time-main">{{ job.workShiftStart }} - {{ job.workShiftEnd }}</span>
                  <span class="time-label">{{ job.startDate | date:'dd/MM' }}</span>
                </div>
                <div class="job-details">
                  <div class="job-header">
                    <h3>{{ job.serviceName }}</h3>
                    <span class="status-indicator" [class]="job.status.toLowerCase()">
                      {{ getStatusLabel(job.status) }}
                    </span>
                  </div>
                  <p class="job-customer">
                    <span class="material-symbols-outlined">person</span>
                    {{ job.customerName }}
                  </p>
                  <p class="job-address">
                    <span class="material-symbols-outlined">location_on</span>
                    {{ job.address }}
                  </p>
                </div>
                <div class="job-actions">
                  <div class="job-price">{{ job.totalPrice | number }}‚Ç´</div>
                  <div class="job-btn-group">
                    <button *ngIf="canConfirm(job)" class="btn-confirm-mini" (click)="confirmJob(job)" [disabled]="isConfirming()">
                      <span class="spinner-mini" *ngIf="isConfirming()"></span>
                      X√°c nh·∫≠n xong
                    </button>
                    <button class="btn-view" [routerLink]="['/helper/schedule']" [queryParams]="{bookingId: job.id}">
                      Chi ti·∫øt
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Recent Completed Jobs -->
      <div class="section history-section">
        <div class="section-header">
          <h2>C√¥ng vi·ªác ƒë√£ ho√†n th√†nh g·∫ßn ƒë√¢y</h2>
        </div>
        
        @if (isLoading()) {
          <div class="loading">ƒêang t·∫£i...</div>
        } @else if (!stats()?.recentCompletedJobs || stats()?.recentCompletedJobs?.length === 0) {
          <div class="empty-card mini">
            <p>B·∫°n ch∆∞a c√≥ c√¥ng vi·ªác n√†o ho√†n th√†nh g·∫ßn ƒë√¢y.</p>
          </div>
        } @else {
          <div class="schedule-list">
            @for (job of stats()?.recentCompletedJobs; track job.id) {
              <div class="job-card completed-item">
                <div class="job-time">
                  <span class="time-main">{{ job.startTime }} - {{ job.endTime }}</span>
                  <span class="time-label">{{ job.startDate | date:'dd/MM' }}</span>
                </div>
                <div class="job-details">
                  <div class="job-header">
                    <h3>{{ job.serviceName }}</h3>
                    <span class="status-indicator completed">HO√ÄN TH√ÄNH</span>
                  </div>
                  <p class="job-customer">
                    <span class="material-symbols-outlined">person</span>
                    {{ job.customerName }}
                  </p>
                  <p class="job-address">
                    <span class="material-symbols-outlined">location_on</span>
                    {{ job.address }}
                  </p>
                </div>
                <div class="job-actions">
                  <div class="job-price">{{ job.totalPrice | number }}‚Ç´</div>
                  <div class="completed-badge">
                    <span class="material-symbols-outlined">check_circle</span>
                    ƒê√£ xong
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>

    <!-- Sidebar Column: Quick Actions -->
    <div class="side-column">
      <div class="section">
        <h2>Truy c·∫≠p nhanh</h2>
        <div class="quick-actions">
          <button routerLink="/helper/profile" class="action-card">
            <span class="material-symbols-outlined profile">person</span>
            <div class="action-info">
              <span class="action-desc">C·∫≠p nh·∫≠t th√¥ng tin v√† khu v·ª±c</span>
            </div>
          </button>
          <button routerLink="/helper/schedule" class="action-card">
            <span class="material-symbols-outlined schedule">calendar_month</span>
            <div class="action-info">
              <span class="action-desc">Xem v√† qu·∫£n l√Ω l·ªãch th√°ng</span>
            </div>
          </button>
          <div class="support-card">
            <span class="material-symbols-outlined">support_agent</span>
            <div class="support-info">
              <span class="title">B·∫°n c·∫ßn h·ªó tr·ª£?</span>
              <p>Li√™n h·ªá ngay v·ªõi t·ªïng ƒë√†i nh√¢n vi√™n ƒë·ªÉ ƒë∆∞·ª£c gi·∫£i ƒë√°p th·∫Øc m·∫Øc.</p>
              <a href="tel:19001234" class="btn-support">G·ªçi 1900 1234</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
